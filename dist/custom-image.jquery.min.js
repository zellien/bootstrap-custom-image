!function(p,d){var e={createUrl:"/admin/media/directory/add",dataUrl:"/admin/media/image?format=json",folderUrl:"/img/icon/folder.png",uploadUrl:"/admin/media/image/upload",placeholder:"/img/no-image.png",title:"Image Manager Tool",prevIcon:"icofont icofont-simple-left",nextIcon:"icofont icofont-simple-right",folderIcon:"icofont icofont-folder",parentIcon:"icofont icofont-simple-up",parentTitle:"Ge to parent directory",refreshIcon:"icofont icofont-refresh",refreshTitle:"Refresh data",uploadIcon:"icofont icofont-upload-alt",uploadTitle:"Upload image",createIcon:"icofont icofont-plus-circle",createTitle:"Create new directory",createPlaceholder:"Enter a name for directory",searchPlaceholder:"What are you looking for?",searchIcon:"icofont icofont-search",searchTitle:"Search"};function a(t,a){this.element=t,this.options=p.extend({},e,a),this.directory="",this.page=1,this.search="",this.token="",this.init()}a.prototype.init=function(){if(p.fn.modal===d)return console.error("Bootstrap modal plugin not available!"),!1;this.renderModal()&&this.prepareEvents(),this.renderTools()},a.prototype.prepareEvents=function(){var o=this,e=this.modal.find(".custom-image-toolbar"),t=this.modal.find(".custom-image-folders"),a=this.modal.find(".custom-image-grid"),i=this.modal.find(".custom-image-pages");p(this.element).on("click",function(t){t.preventDefault(),p(o.modal).modal("show"),o.loadingData()}).on("click","button.custom-image-clear",function(t){t.preventDefault(),t.stopPropagation(),p(o.element).find(".custom-image-input").val(""),p(o.element).find(".custom-image-thumbnail").attr({src:o.options.placeholder,alt:"no image"})}).on("click","button.custom-image-remove",function(t){t.preventDefault(),t.stopPropagation(),p(o.element).remove()}),e.on("click","button[data-action=parent]",function(t){t.preventDefault(),o.directory=("/"+o.directory).replace(/\\/g,"/").replace(/\/[^\/]*$/,"").replace(/^\/|\/$/g,""),o.loadingData(),p(this).trigger("blur")}).on("click","button[data-action=refresh]",function(t){t.preventDefault(),o.loadingData(),p(this).trigger("blur")}).on("click","button[data-action=upload]",function(t){t.preventDefault(),e.find("input[name=custom-image-file]").trigger("click"),p(this).trigger("blur")}).on("shown.bs.popover","button[data-action=create]",function(){p(".custom-image-create input").focus()}).on("keypress","input[name=custom-image-search]",function(t){13===t.originalEvent.which&&(o.search=t.target.value,o.loadingData())}).on("click","button[data-action=search]",function(t){t.preventDefault(),o.search=o.modal.find("input[name=custom-image-search]").val(),o.loadingData(),p(this).trigger("blur")}).on("change","input[name=custom-image-file]",function(t){t.preventDefault();var a=new FormData;a.append("image",t.currentTarget.files[0]),a.append("directory",o.directory),a.append("csrf",o.token),p.ajax(o.options.uploadUrl,{data:a,type:"POST",cache:!1,contentType:!1,processData:!1,success:function(){o.loadingData()}})}),t.on("click",".custom-image-directory",function(){o.directory=p(this).data("directory"),o.loadingData(),p(this).trigger("mouseout")}),a.on("click",".custom-image-item",function(t){t.preventDefault();var a=p(this).data("source"),e=p(this).find(".custom-image-thumbnail");p(o.element).find(".custom-image-input").val(a),p(o.element).find(".custom-image-thumbnail").attr({src:e.attr("src"),alt:e.attr("alt")}),p(o.modal).modal("hide")}),this.modal.on("keypress","input[name=custom-image-create]",function(t){var a=p(this).val();13===t.originalEvent.which&&a.length&&p.ajax(o.options.createUrl,{type:"post",data:{csrf:o.token,name:a,directory:o.directory},success:function(){e.find("button[data-action=create]").popover("hide"),o.loadingData()},complete:function(){}})}),i.on("click",".pagination a.page-link",function(t){t.preventDefault(),o.page=p(this).data("page"),o.loadingData(),p(this).trigger("blur")})},a.prototype.renderTools=function(){var n=this,t=this.modal.find(".custom-image-toolbar"),a=this.modal.find(".custom-image-tools"),e=p("<button>").attr({class:"btn btn-light","data-action":"parent",role:"button",title:this.options.parentTitle}),o=p("<button>").attr({class:"btn btn-light","data-action":"refresh",role:"button",title:this.options.refreshTitle}),i=p("<button>").attr({"data-action":"upload",class:"btn btn-light",role:"button",title:this.options.uploadTitle}),s=p("<button>").attr({"data-action":"create",class:"btn btn-light",role:"button",title:this.options.createTitle}),r=p("<button>").attr({"data-action":"search",class:"btn btn-light",role:"button",title:this.options.searchTitle}),c=p("<input>").attr({class:"form-control",type:"search",name:"custom-image-search",placeholder:this.options.searchPlaceholder});a.append(e,o,i,s),p("<i>").attr({class:this.options.parentIcon}).appendTo(e),p("<i>").attr({class:this.options.refreshIcon}).appendTo(o),p("<i>").attr({class:this.options.uploadIcon}).appendTo(i),p("<i>").attr({class:this.options.createIcon}).appendTo(s),p("<i>").attr({class:this.options.searchIcon}).appendTo(r);var l=p("<div>").attr({class:"input-group custom-image-search"}),d=p("<div>").attr({class:"input-group-append"});d.append(r),l.append(c,d),t.append(l),s.popover({container:n.modal,title:"Create new directory",html:!0,placement:"bottom",sanitize:!1,content:function(){var t=p("<div>").attr({class:"input-group custom-image-create my-1"}),a=p("<input>").attr({class:"form-control",type:"text",name:"custom-image-create",placeholder:n.options.createPlaceholder}),e=p("<div>").attr({class:"input-group-append"}),o=p("<button>").attr({class:"btn btn-light",type:"button"}),i=p("<i>").attr({class:n.options.createIcon});return t.append(a,e),e.append(o),o.append(i),t.get(0)}})},a.prototype.renderDirectories=function(t){var o=this.modal.find(".custom-image-folders").empty(),i=this;t.length?(o.removeClass("d-none"),p.each(t,function(){var t=p("<div>").attr({class:"custom-image-item"}),a=p("<div>").attr({"data-directory":this.directory,title:this.name,class:"custom-image-directory"}).text(this.name),e=p("<i>").attr({class:i.options.folderIcon});p.fn.tooltip!==d&&a.tooltip(),a.prepend(e),t.append(a),o.append(t)})):o.addClass("d-none")},a.prototype.renderThumbs=function(t){var o=this.modal.find(".custom-image-grid").empty();p.each(t,function(){var t=p("<div>").data("source",this.source).addClass("custom-image-item"),a=p(document.createElement("img")).addClass("custom-image-thumbnail").attr("src",this.thumb).attr("alt",this.name),e=p("<div>").attr({class:"custom-image-caption",title:this.name}).text(this.name);p.fn.tooltip!==d&&e.tooltip(),t.append(a,e),o.append(t)})},a.prototype.renderPages=function(i){var t,n=p('<ul class="pagination mb-0">'),s=p(document.createElement("li")).addClass("page-item"),r=new URL(this.options.dataUrl,window.location.origin),a=s.clone(),e=p("<i>").addClass(this.options.prevIcon);(t=i.previous!==d?(r.searchParams.set("page",i.previous),p("<a>").attr({class:"page-link","data-page":i.previous,href:r.toString()})):(a.addClass("disabled"),p("<span>").addClass("page-link"))).append(e),a.append(t),a.appendTo(n),p.each(i.pagesInRange,function(t,a){var e,o=s.clone();(e=a!==i.current?(r.searchParams.set("page",a.toString()),p("<a>").attr({class:"page-link","data-page":a,href:r.toString()})):(o.addClass("active"),p("<span>").addClass("page-link"))).text(a.toString()),o.append(e),o.appendTo(n)});var o,c=s.clone(),l=p("<i>").addClass(this.options.nextIcon);(o=i.next!==d?(r.searchParams.set("page",i.next),p("<a>").attr({class:"page-link","data-page":i.next,href:r.toString()})):(c.addClass("disabled"),p("<span>").addClass("page-link"))).append(l),c.append(o),c.appendTo(n),p(this.modal).find(".custom-image-pages").empty().append(n)},a.prototype.renderModal=function(){return this.modal=p('<div class="modal fade custom-image-modal"><div class="modal-dialog modal-dialog-centered modal-xl"><div class="modal-content"><div class="modal-header"><div class="modal-title">'+this.options.title+'</div><button class="close" data-dismiss="modal" aria-label="Close">&times;</button></div><div class="custom-image-toolbar"><input type="file" name="custom-image-file" class="d-none"><div class="custom-image-tools"></div></div><div class="modal-body"><div class="custom-image-folders"></div><div class="custom-image-grid"></div></div><div class="modal-footer"><div class="col-auto custom-image-pages"></div></div></div></div></div>'),p("body").append(this.modal),!0},a.prototype.loadingData=function(){var t=p(this.modal).find(".modal-body"),a=this,e={directory:this.directory,page:this.page,search:this.search};p.each(e,function(t,a){""!==a&&null!==a||delete e[t]}),p.ajax(this.options.dataUrl,{data:e,cache:!1,beforeSend:function(){t.addClass("loading")},success:function(t){a.renderDirectories(t.directories),a.renderThumbs(t.images),a.renderPages(t.pages),a.token=t.token},complete:function(){t.removeClass("loading")}})},p.fn.customImage=function(t){return this.each(function(){p.data(this,"customImage")||p.data(this,"customImage",new a(this,t))})},p(".custom-image").customImage()}(jQuery);